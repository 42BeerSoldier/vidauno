<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Pong simple</title>
  <style>
    html,body {height:100%;margin:0;background:#111;color:#eee;font-family:sans-serif}
    canvas{display:block;margin:30px auto;background:#000;border:4px solid #222}
    .info{width:600px;margin:0 auto;text-align:center}
  </style>
</head>
<body>
  <div class="info">W/S para mover izquierda — Flechas arriba/abajo para mover derecha — Presiona Espacio para iniciar</div>
  <canvas id="c" width="800" height="500"></canvas>
  <script>
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  const paddle = (x) => ({ x, y: canvas.height/2 - 40, w: 12, h: 80, speed: 6 });
  const left = paddle(20);
  const right = paddle(canvas.width - 32);

  let ball = { x: canvas.width/2, y: canvas.height/2, r:8, vx: 0, vy:0, speed:6 };
  let score = { l:0, r:0 };
  let running = false;

  function resetBall(toLeft) {
    ball.x = canvas.width/2; ball.y = canvas.height/2;
    const angle = (Math.random()*Math.PI/4) - Math.PI/8;
    const dir = toLeft ? -1 : 1;
    ball.vx = dir * ball.speed * Math.cos(angle);
    ball.vy = ball.speed * Math.sin(angle);
  }

  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // mid line
    ctx.fillStyle = '#222';
    for(let y=10;y<canvas.height;y+=30) ctx.fillRect(canvas.width/2-2,y,4,20);

    // paddles
    ctx.fillStyle = '#fff';
    ctx.fillRect(left.x, left.y, left.w, left.h);
    ctx.fillRect(right.x, right.y, right.w, right.h);

    // ball
    ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();

    // score
    ctx.font = '30px monospace'; ctx.textAlign = 'center';
    ctx.fillText(score.l, canvas.width*0.25, 40);
    ctx.fillText(score.r, canvas.width*0.75, 40);

    if(!running) {
      ctx.font = '20px monospace';
      ctx.fillText('Presiona ESPACIO para empezar', canvas.width/2, canvas.height - 30);
    }
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  function update() {
    if(!running) return;
    ball.x += ball.vx; ball.y += ball.vy;

    // top/bottom collision
    if(ball.y - ball.r < 0 || ball.y + ball.r > canvas.height) {
      ball.vy *= -1;
      ball.y = clamp(ball.y, ball.r, canvas.height - ball.r);
    }

    // paddles collision (AABB vs circle approx)
    const checkPaddle = (p) => {
      if(ball.x - ball.r < p.x + p.w && ball.x + ball.r > p.x &&
         ball.y + ball.r > p.y && ball.y - ball.r < p.y + p.h) {
        // reflect and add spin based on where it hits
        const hit = (ball.y - (p.y + p.h/2)) / (p.h/2);
        const angle = hit * Math.PI/4;
        const dir = (ball.x < canvas.width/2) ? 1 : -1;
        ball.speed *= 1.03; // speed up a bit
        ball.vx = dir * ball.speed * Math.cos(angle);
        ball.vy = ball.speed * Math.sin(angle);
        // push ball out
        ball.x = (dir === 1) ? p.x + p.w + ball.r : p.x - ball.r;
      }
    };
    checkPaddle(left); checkPaddle(right);

    // scoring
    if(ball.x < 0) { score.r++; running = false; resetBall(false); }
    if(ball.x > canvas.width) { score.l++; running = false; resetBall(true); }
  }

  // input
  const keys = {};
  window.addEventListener('keydown', e => { keys[e.key.toLowerCase()] = true; if(e.code==='Space'){ if(!running) running=true; }});
  window.addEventListener('keyup', e => { keys[e.key.toLowerCase()] = false; });

  function control() {
    if(keys['w']) left.y -= left.speed;
    if(keys['s']) left.y += left.speed;
    if(keys['arrowup']) right.y -= right.speed;
    if(keys['arrowdown']) right.y += right.speed;
    left.y = clamp(left.y, 0, canvas.height - left.h);
    right.y = clamp(right.y, 0, canvas.height - right.h);
  }

  function loop() {
    control();
    update();
    draw();
    requestAnimationFrame(loop);
  }

  // init
  resetBall(Math.random() < 0.5);
  loop();
  </script>
</body>
</html>
